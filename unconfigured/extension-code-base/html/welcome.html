<!--
 File:      welcome.html
 Author:    Henry Feild
 Date:      31-Mar-2011
 Purpose:   This is the page shown when the user first starts up a new version
            of the %%PROJECT_NAME%%.

%%VERSION%%
-->

<html>
<head>
    <title>%%FULL_PROJECT_NAME%%&mdash;Welcome Page</title>
    <link href="../css/dialog.css" rel="stylesheet" type="text/css">
    <script src="../js/dialog.js"></script>
    <script>
    <!--
        var CROWDLOGGER;
        var pages;
        var frame;
        var cur_page = -1;

        // Used to help us keep track of whether the inner frame has been
        // loaded.
        window.frame_loaded = false;

        /**
         * Checks if this page has been initialized yet. If so, it populates
         * the list of screens and initialization functions.
         */
        function check_if_initialized(){
            // Each entry has the relative url of the page to load in the screen,
            // the initialization (on load) function, and a function that checks
            // if the given page should even be shown.
            pages = [
                ["welcome_first_page.html", 
                    CROWDLOGGER.gui.study.pages.welcome.modify_start_page,
                    function(){return true;}],
                ["consent_form.html",
                    CROWDLOGGER.gui.study.pages.welcome.modify_consent_form,
                    CROWDLOGGER.gui.study.pages.welcome.should_consent_form_be_shown], 
                ["registration.html",
                    CROWDLOGGER.gui.study.pages.welcome.modify_registration_page, 
                    CROWDLOGGER.gui.study.pages.welcome.should_registration_page_be_shown], 
                ["refer_a_friend.html",
                    CROWDLOGGER.gui.study.pages.welcome.modify_refer_a_friend_page,
                    CROWDLOGGER.gui.study.pages.welcome.should_refer_a_friend_page_be_shown],
                ["preferences.html",
                    CROWDLOGGER.gui.study.pages.welcome.modify_preferences_page, 
                    CROWDLOGGER.gui.study.pages.welcome.should_preference_page_be_shown],
                ["welcome_last_page.html", 
                    CROWDLOGGER.gui.study.pages.welcome.modify_last_page,
                    function(){return true;}]
            ];

            // Set the title with the appropriate version. If we cannot get
            // the version of the url, then we just don't set any version number
            // in the title (so it doesn't look weird).
            var version_elm = document.getElementById( "version" );
            var version = get_url_param( "version" );
            if( version !== "" ){
                version_elm.innerHTML = "version " + version;
            }
        }

        /**
         * Advances the welcome wizard to the next screen.
         */
        function next(){
            if( !CROWDLOGGER || !pages ){
                //console.log( "." );
                setTimeout( next, 25 );
                return false;
            }

            if( !frame ){
                frame = document.getElementById( "frame" );
            }

            cur_page++;
            var loaded = false;
            frame_loaded = false;

            var set_timeout = function(){
                setTimeout( function(){ 
                    on_frame_load();
                }, 1 );

            };

            /**
             * Called when the inner frame has loaded; this will initialize
             * the contents of that page with contents tailored to the 
             * Welcome Wizard.
             * @function
             */
            var on_frame_load = function(e){
                //dump( "frame_loaded: " + frame_loaded + "\n" );
                if( frame_loaded ){
                    CROWDLOGGER.debug.log( "Loading frame page!" );
                    pages[cur_page][1]( document, frame.contentDocument ) 
                    //frame.removeEventListener( "load", function(){
                    //on_frame_load(); }, false );
                } else {
                    set_timeout();
                }
            };

            CROWDLOGGER.debug.log( "Setting frame.src: " + pages[cur_page][0] +
                "\n" );

            // Confirm that we should be launching this page.
            if( pages[cur_page][2]() ){
 
                // If so, load the page.
                //frame.setAttribute( "onload", "dump(\"iframe loaded!\" )" );
                set_timeout(); 

                frame.setAttribute( "src",  pages[cur_page][0] );
            } else {
                // Otherwise, advance to the next screen.
                next();
            }

//            pages[cur_page][1]( frame.contentDocument ) 

            return true;
        }

        /**
         * Sets the frame as loaded or not (based on the value parameter).
         * 
         * @param {boolean} value The value that should be given to frame_loaded.
         */
        function set_frame_loaded( value ){
            frame_loaded = value;
        }

        /**
         * Closes the current window.
         */
        function closewindow(){
            window.close();
        }

        // When the window loads, call 'next', which will advance the inner frame
        // of the  wizard to the first page.
        window.addEventListener( "load", next, false );

        // Initialize the search for the CROWDLOGGER variable.
        init_crowdlogger();

    -->
    </script>
</head>
<span class="hidden" id="init"></span>
<body class="welcome" height="90%">

<table height="100%" width="100%" style="margin:0; padding: 0">
<tr><td>
    <div class="header" style="padding: 15px">
        <div class="title"> 
            <span class="titleMain">Welcome</span><br>
            <span id="subtitle">
                <span class="titleSmall">to</span><br>
                <span class="titleSub">%%FULL_PROJECT_NAME%% 
                    <span id="version"></span></span><br>
            </span>
        </div>
    </div>

    <div style=" margin-bottom: 25px;"></div>


    <span id="welcome_wizard_button_panel" 
          class="buttonPanel" 
          style="float: right; padding: 15px;">
                    <span id="welcome_wizzard_next_button" 
                        class="button" onclick=""></span>
                    <span id="welcome_wizzard_next_button_disabled"
                        class="button disabled"></span>
                    <span id="welcome_wizzard_skip_button" 
                        class="button" onclick=""></span>
    </span> 
    <br> 

</td></tr>
<tr height=100% style="margin: 0; padding: 0;">
<td style="margin:0; padding: 0; border-top: 1px steelblue solid">
<iframe id="frame" frameborder=0 marginheight="-5px" marginwidth="-5px" style="margin:-5; padding:0" width="100%" height="100%">
</iframe>
</td></tr>
</table>

</body>
</html>
